<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /app/public

    <Directory /app/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

    # Set HTTPS environment variable for Laravel when behind proxy
    # This makes PHP's $_SERVER['HTTPS'] = 'on' when X-Forwarded-Proto is https
    RequestHeader setenv HTTPS "on" "expr=%{HTTP:X-Forwarded-Proto} == 'https'"
    RequestHeader setenv REQUEST_SCHEME "https" "expr=%{HTTP:X-Forwarded-Proto} == 'https'"

    # Enforce HTTPS
    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>
